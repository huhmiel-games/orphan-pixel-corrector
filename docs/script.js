var p=class{constructor(t,n,c,a,l){this.data=t,this.x=n,this.y=c,this.width=a,this.height=l}};var q=document.getElementById("save-image"),u=document.getElementById("image"),g=document.getElementById("image-canvas"),x=document.getElementById("left-panel"),L=document.getElementById("right-panel"),i=document.getElementById("fixed-canvas"),h=document.getElementById("check-canvas"),G=document.getElementById("check-only"),N=document.getElementById("multipass"),R=document.getElementById("console"),M=document.getElementById("undo-btn"),B=document.getElementById("redo-btn"),o={name:"",width:0,height:0,isLoaded:!1,zoom:1},I=!0,D=!1,H=0,m=0,w=0,y=[],E=[],S=null,P,K=((P=document.querySelector("nav"))==null?void 0:P.clientHeight)||58;document.querySelectorAll('[id ^= "close-"]').forEach(e=>e.addEventListener("click",_));var X;(X=document.getElementById("open-image"))==null||X.addEventListener("change",ee,!1);var A;(A=document.getElementById("about-btn"))==null||A.addEventListener("click",Z,!1);document.addEventListener("wheel",le,{passive:!1});document.addEventListener("keydown",se);document.addEventListener("click",re);G.addEventListener("change",ae);N.addEventListener("change",ce);M.addEventListener("click",W,!1);B.addEventListener("click",F,!1);q.addEventListener("click",U,!1);x.addEventListener("scroll",Q);L.addEventListener("scroll",J);i.addEventListener("mousemove",V);function J(){x.scroll(L.scrollLeft,L.scrollTop)}function Q(){L.scroll(x.scrollLeft,x.scrollTop)}function V(e){e.ctrlKey===!0&&i.classList.contains("pick-color")?i.classList.replace("pick-color","edit-color"):e.ctrlKey===!1&&i.classList.contains("edit-color")&&i.classList.replace("edit-color","pick-color")}function Z(e){e.preventDefault();let t=document.getElementById(e.currentTarget.getAttribute("data-target"));t.open=!0,S=t}function _(e){S=null,e.preventDefault();let t=document.getElementById(e.currentTarget.getAttribute("data-target"));t.open=!1}function ee(e){let t=e.target.files;if(t.length>0){o.name=t.name;let c=URL.createObjectURL(t[0]);u.src=c,u.addEventListener("load",a=>{o.width=u.naturalWidth,o.height=u.naturalHeight,g.classList.remove("none"),C(g,u),C(i,u),h.width=o.width,h.height=o.height,o.isLoaded=!0,m=0,z(),Y()},{once:!0})}}function Y(){let e=new Date().toLocaleString(),t=document.createElement("code");t.innerText=`${e}
${H} pixels found.
${m} pixels found without viable correction.
-------------------
`,R.insertBefore(t,R.children[0])}function te(){let e=g.getContext("2d"),t=i.getContext("2d");!e||!t||(e.clearRect(0,0,o.width,o.height),t.clearRect(0,0,o.width,o.height),C(g,u),C(i,u),H=0,m=0,w=0)}function z(){let e=g.getContext("2d"),t=i.getContext("2d"),n=h.getContext("2d");if(!e||!t||!n)return;let c=o.width,a=o.height,l=document.getElementById("check-color").value,s=O(l);for(let d=0;d<a;d+=1)for(let f=0;f<c;f+=1){let r=e.getImageData(f,d,1,1),v=`${r.data[0]}-${r.data[1]}-${r.data[2]}-${r.data[3]}`;if(v==="0-0-0-0")continue;let T=ne(e,f,d);if(T.includes(v))continue;let k=oe(T);if(I===!0&&(r.data[0]=s[0],r.data[1]=s[1],r.data[2]=s[2],r.data[3]=255,n.putImageData(r,f,d),k||(m+=1)),T.length>0){if(!k){m+=1;continue}let b=k.split("-");r.data[0]=+b[0],r.data[1]=+b[1],r.data[2]=+b[2],r.data[3]=+b[3],H+=1,t.putImageData(r,f,d)}}if(D&&w!==m){w=m,m=0;let d=t.getImageData(0,0,c,a);e.putImageData(d,0,0),z()}}function ne(e,t,n){let c=e.getImageData(t-1,n-1,3,3).data,a=[];for(let s=0;s<c.length;s+=4){let d=`${c[s]}-${c[s+1]}-${c[s+2]}-${c[s+3]}`;a.push(d)}return a.splice(4,1),a.filter(s=>s!=="0-0-0-0")}function oe(e){let t=e.reduce((a,l)=>(a[l]=a[l]||0,a[l]++,a),{}),n=Object.keys(t).reduce((a,l)=>t[l]>t[a]?l:a);if(!(e.filter(a=>a===n).length<=1))return n}function ae(){I=!I,o.isLoaded&&(h.style.display=I?"block":"none")}function ce(){D=!D,o.isLoaded&&(te(),z(),Y())}function U(){let e=i.toDataURL("image/png"),t=new XMLHttpRequest;t.responseType="blob",t.onload=function(){let n=document.createElement("a");n.href=window.URL.createObjectURL(t.response),n.download=o.name,n.style.display="none",document.body.appendChild(n),n.click(),n.remove()},t.open("GET",e),t.send()}function le(e){if(e.ctrlKey&&e.preventDefault(),e.ctrlKey&&o.isLoaded){let t=0,n=0,c=1;if(e.wheelDelta>0){if(o.zoom===64)return;o.zoom=ie(o.zoom+c,0,64),t=(e.offsetX-e.clientX/2)*2,n=(e.offsetY-(e.clientY-K)/2)*2}else if(e.wheelDelta<0){if(o.zoom<.02)return;o.zoom-=c,t=(e.offsetX-e.clientX*2)/2,n=(e.offsetY-(e.clientY-K)*2)/2}g.style.width=o.width*o.zoom+"px",g.style.height=o.height*o.zoom+"px",i.style.width=o.width*o.zoom+"px",i.style.height=o.height*o.zoom+"px",h.style.width=o.width*o.zoom+"px",h.style.height=o.height*o.zoom+"px",x.scroll(t,n),L.scroll(t,n)}}function se(e){if(e.ctrlKey&&e.key==="z"&&y.length){e.preventDefault(),W();return}if(e.ctrlKey&&e.key==="y"&&E.length){e.preventDefault(),F();return}if(e.ctrlKey&&e.key==="s"&&o.isLoaded){e.preventDefault(),U();return}}function C(e,t,n=0,c=0){let a=e.getContext("2d");!a||(e.width=t.naturalWidth,e.height=t.naturalHeight,a.drawImage(t,n,c))}function ie(e,t,n){return Math.max(t,Math.min(e,n))}function O(e){e=e.toUpperCase();let t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),c=parseInt(e.slice(5,7),16);return[t,n,c]}function $(e,t=!1){return"#"+e.map(n=>n.toString(16)).map(n=>n.length===1?"0"+n:n).join("")}function re(e){if(e.target.id==="image-canvas"){let t=g.getContext("2d");if(!t)return;let n=e.offsetX/o.zoom,c=e.offsetY/o.zoom,l=t.getImageData(n,c,1,1).data,s=$([l[0],l[1],l[2]]);document.getElementById("check-color").value=s}if(e.target.id==="fixed-canvas"&&e.ctrlKey===!1){let t=i.getContext("2d");if(!t)return;let n=e.offsetX/o.zoom,c=e.offsetY/o.zoom,l=t.getImageData(n,c,1,1).data,s=$([l[0],l[1],l[2]]);document.getElementById("check-color").value=s}if(e.target.id==="fixed-canvas"&&e.ctrlKey===!0){let t=Math.floor(e.offsetX/o.zoom),n=Math.floor(e.offsetY/o.zoom);de(t,n)}}function de(e,t){let n=i.getContext("2d");if(!n)return;let c=document.getElementById("check-color").value,a=O(c),l=n.getImageData(e,t,1,1);j(l,e,t,1,1);let s=n.getImageData(e,t,1,1);s.data[0]=a[0],s.data[1]=a[1],s.data[2]=a[2],s.data[3]=255,n.putImageData(s,e,t)}function j(e,t,n,c,a){let l=new p(e,t,n,c,a);y.push(l),M.disabled=!1}function ue(e,t,n,c,a){let l=new p(e,t,n,c,a);E.push(l),B.disabled=!1}function W(){let e=y.at(-1);if(!e)return;let t=i.getContext("2d");if(!t)return;let n=t.getImageData(e.x,e.y,1,1);ue(n,e.x,e.y,e.width,e.height),t.clearRect(e.x,e.y,1,1),t.putImageData(e.data,e.x,e.y),y.pop(),y.length===0&&(M.disabled=!0)}function F(){let e=E.at(-1);if(!e)return;let t=i.getContext("2d");if(!t)return;let n=t.getImageData(e.x,e.y,e.width,e.height);j(n,e.x,e.y,e.width,e.height),t.clearRect(e.x,e.y,1,1),t.putImageData(e.data,e.x,e.y),E.pop(),E.length===0&&(B.disabled=!0)}
//# sourceMappingURL=script.js.map
